# تعديلات 13 يناير 2026

## ملخص التعديلات

تم إجراء تعديلين رئيسيين في هذا التاريخ:

---

## التعديل الأول (01:28 صباحاً)

**Commit:** `c6dd33a`  
**المؤلف:** hesham  
**التاريخ:** 2026-01-13 01:28:06  
**الوصف:** Refactor image handling across components to exclusively use Digital Ocean sources. Removed Airtable fetch logic and unnecessary image state management in candidate and homemaid pages, streamlining image retrieval and improving performance.

### الملفات المعدلة:

#### 1. `app/api/homemaid/[id]/route.ts`
- تعليق حقل `Housed: true` في استعلامات GET و PUT
- إزالة حقل `OldPeopleCare` من عملية التحديث (PUT)

#### 2. `app/candidates/page.tsx`
- **حذف:** دالة `fetchImageDateAirtable` بالكامل
- **حذف:** حالات `imageSrc` و `isImageLoading`
- **حذف:** `useEffect` الذي كان يجلب الصور من Airtable
- **تعديل:** استخدام `candidate.Picture.url` مباشرة من Digital Ocean
- **تبسيط:** إزالة منطق التحميل المعقد للصور

#### 3. `app/cv/[id]/page.tsx`
- **حذف:** حالات `image` و `fullImage`
- **حذف:** `useEffect` الذي كان يجلب الصور من Airtable
- **تعديل:** استخدام `homemaid.Picture` و `homemaid.FullPicture` مباشرة
- **تبسيط:** إزالة منطق جلب الصور من API `/api/fetchbothimage/[id]`

#### 4. `app/cvdetails/page.tsx`
- **حذف:** حالة `image`
- **حذف:** دالة `fetchImageDateAirtable`
- **تعديل:** استخدام `homemaid.Picture.url` مباشرة من Digital Ocean

#### 5. `app/homemaid/[id]/page.tsx`
- **حذف:** حالة `image`
- **حذف:** دالة `fetchImageDateAirtable`
- **تعديل:** استخدام `homemaid.Picture.url` مباشرة من Digital Ocean

#### 6. `prisma/schema.prisma`

##### إضافات جديدة:

**في نموذج `homemaid`:**
- `children Int?` - عدد الأطفال
- `isApproved Boolean? @default(false)` - حالة الموافقة
- `contractType String @default("recruitment") @db.VarChar(100)` - نوع العقد
- `BabySitterLevel String? @db.VarChar(100)` - مستوى رعاية الأطفال

**في نموذج `User`:**
- `email String? @db.VarChar(191)` - البريد الإلكتروني
- `pictureurl` تم تغييره من `@db.VarChar(1024)` إلى `@db.LongText`

**في نموذج `professions`:**
- `gender String? @db.VarChar(50)` - الجنس (male, female, or null for both)

**في نموذج `AccountSystemLogs`:**
- `details String? @db.VarChar(255)` - تفاصيل إضافية

**في نموذج `neworder`:**
- `ReasonOfCancellation String? @db.VarChar(255)` - سبب الإلغاء
- `visaId Int?` - معرف التأشيرة
- `visa visa? @relation(fields: [visaId], references: [id])` - علاقة مع نموذج التأشيرة

**في نموذج `visa`:**
- `visaFile` تم تغييره من `@db.VarChar(255)` إلى `@db.VarChar(1024)`
- `orders neworder[]` - علاقة مع الطلبات

**في نموذج `EmployeeCash`:**
- `isTemporary Boolean @default(false)` - سجل مؤقت (يُحذف تلقائياً إذا لم يكتمل)
- `employeeId` أصبح اختياري (`Int?`)

**نموذج جديد `Complaint`:**
```prisma
model Complaint {
  id                Int       @id @default(autoincrement())
  title             String?   @db.VarChar(255)
  description       String?   @db.Text
  screenshot         String?   @db.VarChar(1024)
  status            String    @default("pending") @db.VarChar(50)
  createdById       Int
  createdBy         User      @relation("ComplaintCreatedBy", fields: [createdById], references: [id])
  assignedToId      Int?
  assignedTo        User?     @relation("ComplaintAssignedTo", fields: [assignedToId], references: [id])
  resolutionNotes   String?   @db.Text
  resolvedAt        DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}
```

##### تعديلات:

- `displayOrder` في `homemaid`: أصبح `Int?` و `@unique` بدلاً من `Int @default(0)`
- `employeeId` في `EmployeeCash`: أصبح اختياري (`Int?`)

##### حذف/تعليق:

- تعليق نموذج `housing` بالكامل
- تعليق علاقة `Housed` في `homemaid` و `neworder`
- حذف حقل `OldPeopleCare` من `homemaid`
- تعليق نموذج `PDFExtractedRecord`

**إحصائيات:** 6 ملفات معدلة، 85 إضافة، 137 حذف

---

## التعديل الثاني (01:41 صباحاً)

**Commit:** `db273ee`  
**المؤلف:** hesham  
**التاريخ:** 2026-01-13 01:41:37  
**الوصف:** Remove unused Airtable image fetching APIs and commented out fields in homemaid route, streamlining the codebase and improving maintainability.

### الملفات المحذوفة:

#### 1. `app/api/fetchbothimage/[id]/route.ts` (45 سطر)
- API كان يستخدم لجلب الصور من Airtable
- تم حذفه بالكامل

#### 2. `app/api/getimagefromat/[id]/route.ts` (45 سطر)
- API كان يستخدم لجلب صورة واحدة من Airtable
- تم حذفه بالكامل

### الملفات المعدلة:

#### `app/api/homemaid copy/[id]/route.ts`
- تعليق `Housed: true` في استعلامات GET و PUT
- تعليق `OldPeopleCare` في عملية التحديث (PUT)

**إحصائيات:** 3 ملفات، 3 إضافات، 93 حذف

---

## ملخص التغييرات الإجمالية

### الأهداف الرئيسية:
1. ✅ **إزالة الاعتماد على Airtable** - جميع الصور الآن من Digital Ocean فقط
2. ✅ **تبسيط الكود** - إزالة حالات وإجراءات غير ضرورية
3. ✅ **تحسين الأداء** - تقليل عدد طلبات API
4. ✅ **تحديث قاعدة البيانات** - إضافة حقول ونماذج جديدة

### الملفات المتأثرة:

#### ملفات معدلة:
- `app/api/homemaid/[id]/route.ts`
- `app/candidates/page.tsx`
- `app/cv/[id]/page.tsx`
- `app/cvdetails/page.tsx`
- `app/homemaid/[id]/page.tsx`
- `app/api/homemaid copy/[id]/route.ts`
- `prisma/schema.prisma`

#### ملفات محذوفة:
- `app/api/fetchbothimage/[id]/route.ts`
- `app/api/getimagefromat/[id]/route.ts`

### الإحصائيات النهائية:
- **إجمالي الملفات المعدلة:** 7 ملفات
- **إجمالي الملفات المحذوفة:** 2 ملف
- **إجمالي الإضافات:** 88 سطر
- **إجمالي الحذف:** 230 سطر
- **صافي التغيير:** -142 سطر (تقليل في حجم الكود)

---

## التأثير على النظام

### قبل التعديلات:
- الصور كانت تُجلب من Airtable و Digital Ocean
- استخدام حالات معقدة لإدارة تحميل الصور
- APIs إضافية لجلب الصور من Airtable
- كود معقد لإدارة مصادر متعددة للصور

### بعد التعديلات:
- الصور تُجلب من Digital Ocean فقط
- استخدام مباشر لـ `Picture.url` و `FullPicture.url`
- إزالة APIs غير ضرورية
- كود أبسط وأسهل في الصيانة
- تحسين في الأداء (تقليل طلبات API)

---

## ملاحظات مهمة

1. **تأكد من تحديث قاعدة البيانات:**
   ```bash
   npx prisma migrate dev
   ```

2. **تأكد من وجود الصور في Digital Ocean:**
   - جميع الصور يجب أن تكون متاحة في Digital Ocean
   - تأكد من أن `Picture.url` و `FullPicture.url` يحتويان على روابط صحيحة

3. **اختبار الصفحات:**
   - `/candidates` - صفحة المرشحات
   - `/cv/[id]` - صفحة السيرة الذاتية
   - `/cvdetails` - تفاصيل السيرة الذاتية
   - `/homemaid/[id]` - صفحة العاملة

---

*تم إنشاء هذا الملف تلقائياً بتاريخ 2026-01-13*


